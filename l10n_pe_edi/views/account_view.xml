<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="debit_view_account_journal_form" model="ir.ui.view">
        <field name="name">account.journal.form.inherit</field>
        <field name="model">account.journal</field>
        <field name="inherit_id" ref="account.view_account_journal_form"/>
        <field name="priority">1</field>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='refund_sequence']" position="after">
                <field name="charge_sequence" attrs="{'invisible': [('type', 'not in', ['sale','purchase'])]}" groups="base.group_no_one"/>
            </xpath>
            <xpath expr="//field[@name='refund_sequence_id']" position="after">
                <field name="charge_sequence_id" attrs="{'invisible': ['|',('type', 'not in', ['sale','purchase']), ('charge_sequence', '!=', True)], 'required': [('type', 'in', ['sale']), ('charge_sequence', '=', True)]}"/>
            </xpath>
        </field>
    </record>
    <record id="invoice_tree" model="ir.ui.view">
        <field name="name">account.invoice.tree</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.invoice_tree"/>
        <field name="priority">1</field>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='state']" position="after">
                <field name="l10n_pe_edi_pse_status"/>
            </xpath>
        </field>
    </record>
    <record id="debit_button_invoice_form" model="ir.ui.view">
        <field name="name">account.invoice.form</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.invoice_form"/>
        <field name="priority">17</field>
        <field name="arch" type="xml">
            <xpath expr="//button[@name='action_invoice_cancel']" position="attributes">
                <attribute name="states"></attribute>
                <attribute name="attrs">{'invisible':['|',('l10n_pe_document_type', '!=', False),('state','not in',('draft','proforma2','open')),'|',('state', '!=', 'draft'),('l10n_pe_document_type', '=', False)]}</attribute>
            </xpath>
            <xpath expr="//button[@name='%(account.action_account_invoice_refund)d']" position="attributes">
                <attribute name="attrs">{'invisible': ['|', '|', ('type', '=', 'out_refund'), ('state', 'not in', ('open','proforma2','paid')), ('refund_invoice_id', '!=', False)]}</attribute>
            </xpath>
            <xpath expr="//button[@name='%(account.action_account_invoice_refund)d']" position="after">
                <field name="refund_invoice_id" invisible="1"/>
                <button name="%(account.action_account_invoice_refund)d"
                    type='action' string='Charge Invoice'
                    groups="account.group_account_invoice"
                    context="{'default_filter_refund2': 'charge'}"
                    attrs="{'invisible': ['|', ('state', 'not in', ('open','proforma2','paid')), ('refund_invoice_id', '!=', False)]}"/>
                <field name="l10n_pe_document_type" invisible="1"/>
                <button name="%(action_invoice_cancel_wizard)d"
                    type='action' string='Cancel SUNAT'
                    attrs="{'invisible': ['|','|',('state', 'not in', ('open','paid')),('l10n_pe_document_type', '=', False)]}"/>
            </xpath>
            <xpath expr="//sheet/group//group[last()]" position="inside">
                <field name="l10n_pe_edi_summary_id" invisible="1"/>
                <label for="l10n_pe_edi_pse_status" states="open,paid,cancel"/>
                <div class="o_row">
                    <field name="l10n_pe_edi_pse_status" states="open,paid,cancel"/>
                    <button name="l10n_pe_edi_update_pse_status" type="object" class="oe_link" string="Retry"
                        groups="l10n_pe_edi.group_account_invoice_pe"
                        attrs="{'invisible': ['|', '|', ('state', 'not in', ('open','paid')), ('l10n_pe_edi_pse_status', 'in', ['to_valid', 'valid', 'to_cancel', 'cancelled']), ('l10n_pe_document_type', '=', '03')]}"/>
                    <button name="l10n_pe_edi_action_get_status_cdr_sunat" type="object" class="oe_link" string="Get CDR Status"
                        groups="l10n_pe_edi.group_account_invoice_pe"
                        attrs="{'invisible': ['|', ('l10n_pe_edi_pse_status', 'not in', ['with_error', 'signed','to_cancel']), ('l10n_pe_document_type', '=', '03')]}"/>
                <button name="%(action_ticket_update_wizard)d"
                    type='action' string='Update ticket'
                    attrs="{'invisible': [('l10n_pe_edi_pse_status', 'in', ['valid', 'cancelled'])]}"
                    />
                </div>
                <label for="l10n_pe_edi_ticket_number" states="open,paid,cancel"  attrs="{'invisible':['|', '|', '|', ('l10n_pe_edi_ticket_number', '=', False), ('l10n_pe_edi_pse_status', 'not in', ('in_process', 'with_error')), ('l10n_pe_edi_summary_id', '=', False)]}"/>
                <div class="o_row">
                    <field name="l10n_pe_edi_ticket_number" states="open,paid,cancel"/>
                    <button name="l10n_pe_edi_action_send_summary_sunat" type="object" class="oe_link"
                        groups="l10n_pe_edi.group_account_invoice_pe"
                        string="Send summary" attrs="{'invisible':['|', '|', '|', ('l10n_pe_edi_ticket_number', '!=', False), ('l10n_pe_edi_pse_status', 'not in', ('in_process', 'with_error', 'to_be_cancelled')), ('l10n_pe_edi_summary_id', '=', False)]}"/>
                    <button name="l10n_pe_edi_action_get_status_sunat" type="object" class="oe_link"
                        groups="l10n_pe_edi.group_account_invoice_pe"
                        string="Get status" attrs="{'invisible':['|', '|', '|', ('l10n_pe_edi_ticket_number', '=', False), ('l10n_pe_edi_pse_status', 'not in', ('in_process', 'with_error', 'to_be_cancelled')), ('l10n_pe_edi_summary_id', '=', False)]}"/>
                    <button name="l10n_pe_edi_action_regenerate" type="object" class="oe_link"
                        groups="l10n_pe_edi.group_account_invoice_pe"
                        string="Regenerate" attrs="{'invisible':['|', ('l10n_pe_edi_summary_id', '=', False), ('l10n_pe_edi_pse_status', 'in', ['valid', 'cancelled'])]}"
                        confirm="Maybe the validation is still in progress. Are you sure that you want to regenerate?"/>
                </div>
            </xpath>
            <xpath expr="//header" position="after">
                <div class="alert alert-danger" role="alert" style="margin-bottom:0px;" attrs="{'invisible': [('l10n_pe_edi_error_message', '=', False)]}">
                    <field name="l10n_pe_edi_error_message"/>
                </div>
            </xpath>
        </field>
    </record>
    <record id="customer_invoice_and_refunds" model="ir.filters">
        <field name="name">Customer Invoice and Refunds</field>
        <field name="model_id">account.invoice</field>
        <field name="domain">[('state', '!=', 'draft'), ('state', '!=', 'cancel'), '|', ('type', '=', 'out_invoice'), ('type', '=', 'out_refund')]</field>
        <field name="user_id" eval="False"/>
    </record>
</odoo>
